<div class="sp-ai-widget" data-sp-ai-widget-version="{{version}}">
    <div class="sp-ai-header">
        <div class="sp-ai-title">{{title}}</div>
        <div class="sp-ai-status sp-ai-status-{{status}}">{{status_label}}</div>
    </div>

    {{#if show_caption}}
        <div class="sp-ai-caption">{{caption}}</div>
    {{/if}}

    {{#if show_tool}}
        <div class="sp-ai-meta">
            <span class="sp-ai-meta-key">Tool</span>
            <span class="sp-ai-meta-val">{{tool}}</span>
        </div>
    {{/if}}

    {{#if has_subagent_groups}}
        <details class="sp-ai-section sp-ai-subagent-section" open>
            <summary>
                <span>{{subagent_section_title}}</span>
            </summary>

            <div class="sp-ai-subagent-groups">
                {{#each subagent_groups}}
                    {{#if title}}
                        <div class="sp-ai-subagent-group-title">{{title}}</div>
                    {{/if}}

                    {{#if agents}}
                        <ul class="sp-ai-subagent-list">
                            {{#each agents}}
                                <li class="sp-ai-subagent">
                                    <span class="sp-ai-subagent-status sp-ai-subagent-status-{{status}}">
                                        {{status_label}}
                                    </span>

                                    <div class="sp-ai-subagent-main">
                                        <div class="sp-ai-subagent-head">
                                            <span class="sp-ai-subagent-type">{{type}}</span>
                                            <span class="sp-ai-subagent-desc">{{description}}</span>
                                        </div>

                                        {{#if meta_line}}
                                            <div class="sp-ai-subagent-meta">{{meta_line}}</div>
                                        {{/if}}

                                        {{#if error}}
                                            <div class="sp-ai-subagent-error">{{error}}</div>
                                        {{/if}}
                                    </div>

                                    {{#if agentURL}}
                                        <a
                                            class="sp-ai-subagent-link"
                                            href="{{agentURL}}"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            >Open</a
                                    {{/if}}
                                </li>
                            {{/each}}
                        </ul>
                    {{else}}
                        {{#if fallback_text}}
                            <pre class="sp-ai-pre">{{fallback_text}}</pre>
                        {{/if}}
                    {{/if}}
                {{/each}}
            </div>
        </details>
    {{/if}}

    {{#if has_input}}
        <details class="sp-ai-section">
            <summary>
                <span>Input</span>
                <button class="sp-ai-copy" type="button" data-copy="input">Copy</button>
            </summary>
            <pre class="sp-ai-pre">{{input}}</pre>
        </details>
    {{/if}}

    {{#if has_output}}
        <details class="sp-ai-section" open>
            <summary>
                <span>Output</span>
                <button class="sp-ai-copy" type="button" data-copy="output">Copy</button>
            </summary>
            <pre class="sp-ai-pre">{{output}}</pre>
        </details>
    {{/if}}
</div>
