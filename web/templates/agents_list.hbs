{{#each agents}}
    <div class="agent-row overlay-message-row" data-agent-id="{{id}}" data-paused="{{#if (lookup . 'pausedAt')}}true{{else}}false{{/if}}">
        <div class="agent-info-box overlay-message-info-box" tabindex="0">
            <div class="agent-name"><strong>{{name}}</strong></div>
            <div class="agent-id">{{t 'ID' }}: {{id}}</div>
            {{#if usage}}
                {{#if (or usage.runsToday usage.costUsd30d usage.costUsdMonth (lookup . 'budgetMonthlyUsd'))}}
                    <div class="agent-usage">
                        {{#if usage.runsToday}}Runs today: {{usage.runsToday}}{{/if}}
                        {{#if (and usage.runsToday (or usage.costUsd30d usage.costUsdMonth (lookup . 'budgetMonthlyUsd')))}} · {{/if}}
                        {{#if usage.costUsd30d}}Cost (30d): ${{usage.costUsd30d}}{{/if}}
                        {{#if (and usage.costUsd30d (or usage.costUsdMonth (lookup . 'budgetMonthlyUsd')))}} · {{/if}}
                        {{#if usage.costUsdMonth}}Cost (month): ${{usage.costUsdMonth}}{{/if}}
                        {{#if (and usage.costUsdMonth (lookup . 'budgetMonthlyUsd'))}} · {{/if}}
                        {{#if (lookup . 'budgetMonthlyUsd')}}Budget: ${{lookup . 'budgetMonthlyUsd'}}/mo{{/if}}
                    </div>
                {{/if}}
            {{else}}
                {{#if (or runsToday costUsd30d costUsdMonth (lookup . 'budgetMonthlyUsd'))}}
                    <div class="agent-usage">
                        {{#if runsToday}}Runs today: {{runsToday}}{{/if}}
                        {{#if (and runsToday (or costUsd30d costUsdMonth (lookup . 'budgetMonthlyUsd')))}} · {{/if}}
                        {{#if costUsd30d}}Cost (30d): ${{costUsd30d}}{{/if}}
                        {{#if (and costUsd30d (or costUsdMonth (lookup . 'budgetMonthlyUsd')))}} · {{/if}}
                        {{#if costUsdMonth}}Cost (month): ${{costUsdMonth}}{{/if}}
                        {{#if (and costUsdMonth (lookup . 'budgetMonthlyUsd'))}} · {{/if}}
                        {{#if (lookup . 'budgetMonthlyUsd')}}Budget: ${{lookup . 'budgetMonthlyUsd'}}/mo{{/if}}
                    </div>
                {{/if}}
            {{/if}}
            {{#if (lookup . 'pausedAt')}}
                <div class="agent-paused-label">{{t 'Paused'}}</div>
            {{/if}}
        </div>
        <div class="overlay_message_controls">
            <button type="button" class="action-button manage-memory-blocks-button">{{t 'Memory blocks' }}</button>
            <button type="button" class="action-button toggle-pause-agent-button">{{#if (lookup . 'pausedAt')}}{{t 'Unpause'}}{{else}}{{t 'Pause'}}{{/if}}</button>
            <button type="button" class="action-button edit-budget-agent-button">{{t 'Budget' }}</button>
            <button type="button" class="action-button action-button-subtle-danger archive-agent-button">{{t 'Archive' }}</button>
        </div>

        <form class="agent-budget-inline-form" style="display:none">
            <label>
                {{t 'Monthly USD' }}
                <input type="text" class="agent-budget-monthly-usd" value="{{lookup . 'budgetMonthlyUsd'}}" />
            </label>
            <label>
                {{t 'Daily runs' }}
                <input type="text" class="agent-budget-daily-runs" value="{{lookup . 'budgetDailyRuns'}}" />
            </label>
            <button type="submit" class="action-button save-budget-agent-button">{{t 'Save' }}</button>
        </form>
    </div>
{{else}}
    <div class="no-overlay-messages">
        {{t 'No agents.'}}
    </div>
{{/each}}
